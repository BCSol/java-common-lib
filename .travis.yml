language: java
# Only for newer ant, containers on Travis only have ant 1.8.2 which fails
sudo: required
dist: trusty
jdk:
  - oraclejdk8
env:
  global:
    - GH_REF: github.com/dbeyer/common-java.git
  matrix:
    - NAME='Build and run tests'
install:
  - ant resolve-dependencies -Divy.repo.url=http://www.sosy-lab.org/ivy
script:
  - ant unit-tests-coverage
matrix:
  include:
    - env: NAME='Build with ECJ'
      script:
        - ant build-project-ecj
      jdk: oraclejdk8
    - env: NAME='Create Javadoc'
      script:
        - ant javadoc
      jdk: oraclejdk8
    - env: NAME=Checkstyle
      script:
        - ant run-checkstyle -Dcheckstyle.output=plain && cat Checkstyle*.xml && [ $(cat Checkstyle*.xml | grep -vic audit) -eq 0 ]
      jdk: oraclejdk8
    - env: NAME=FindBugs
      script:
        - ant run-findbugs -Dfindbugs.output=text && cat FindBugs.xml && test \! -s FindBugs.xml
      jdk: oraclejdk8
    - env: NAME='Check source-code format'
      script:
        - ant format-source && git diff -s --exit-code
      jdk: oraclejdk8
deploy:
  - skip_cleanup: true
    provider: script
    script: build/deploy-gh-pages.sh
    on:
      condition: $NAME = "Create Javadoc"
  - skip_cleanup: true
    provider: script
    script: build/deploy-coverage.sh
    on:
      condition: $NAME = "Build and run tests"
notifications:
  email:
    - common-java-dev@googlegroups.com
git:
  depth: 1
cache:
  directories:
  - $HOME/.ivy2
